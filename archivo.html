<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Mini Clon Claude - Autocontenible</title>
  <style>
    body {
      background: #f6f7fb;
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      color: #222;
    }
    .container {
      max-width: 700px;
      margin: 40px auto;
      padding: 30px 30px 20px 30px;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 6px 30px #0001;
    }
    h1 { text-align: center; color: #8c55aa; margin-bottom: 10px; }
    #chatbox {
      border: 1px solid #e1e1e1;
      border-radius: 12px;
      background: #fcfcfd;
      height: 260px;
      overflow-y: auto;
      padding: 15px;
      margin-bottom: 15px;
      font-size: 16px;
    }
    .chat-msg { margin-bottom: 10px; }
    .user { color: #0b6fa4; }
    .bot { color: #8c55aa; }
    #inputRow { display: flex; gap: 8px; }
    #userInput {
      flex: 1;
      padding: 8px 12px;
      border-radius: 8px;
      border: 1px solid #bbb;
      font-size: 16px;
    }
    button {
      background: #8c55aa;
      color: #fff;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
      transition: background 0.2s;
    }
    button:hover { background: #0b6fa4; }
    #canvasRow { margin-top: 26px; display: flex; flex-direction: column; align-items: center;}
    #mainCanvas { background: #f4eefc; border: 1px solid #ccc; border-radius: 10px;}
    #ocrInput { margin-top: 10px;}
    #ocrResult { background: #e8e0f5; border-radius: 6px; padding: 6px 10px; margin-top: 8px;}
    .small { font-size: 13px; color: #888; margin: 4px 0 0 0;}
  </style>
</head>
<body>
  <div class="container">
    <h1>Mini Clon Claude</h1>
    <div id="chatbox"></div>
    <div id="inputRow">
      <input type="text" id="userInput" placeholder="Escribe tu pregunta de programación..." autocomplete="off" />
      <button onclick="sendMsg()">Enviar</button>
    </div>
    <div class="small">Mentoría de programación, generación de código y chat simulado.</div>
    <hr style="margin: 30px 0 20px 0;">
    <div id="canvasRow">
      <canvas id="mainCanvas" width="360" height="180"></canvas>
      <div style="margin-top: 10px;">
        <button onclick="drawRect()">Dibujar Rectángulo</button>
        <button onclick="clearCanvas()">Limpiar</button>
        <button onclick="exportCanvas()">Exportar PNG</button>
      </div>
      <div class="small">Puedes dibujar, limpiar o exportar el contenido del canvas.</div>
      <input id="ocrInput" type="file" accept="image/*" />
      <button onclick="performOCR()">Realizar OCR</button>
      <div id="ocrResult"></div>
      <div class="small">OCR básico usando Tesseract.js embebido (funciona 100% offline).</div>
    </div>
  </div>
  <!-- Tesseract.js minificado para OCR (completamente embebido) -->
  <script>
/* --- INICIO Tesseract.js minificado --- */
/* 
Pega aquí el contenido COMPLETO de tesseract.min.js 
Descárgalo desde: 
https://cdn.jsdelivr.net/npm/tesseract.js@2.1.4/dist/tesseract.min.js 
y reemplaza esta línea y este comentario.
¡El archivo funcionará completamente offline!
*/
/* --- FIN Tesseract.js minificado --- */
  </script>
  <script>
    // Chat simulado
    const chatbox = document.getElementById('chatbox');
    const userInput = document.getElementById('userInput');
    const predef = [
      {
        q: /hola|buenas/i,
        a: "¡Hola! ¿En qué puedo ayudarte hoy con programación?"
      },
      {
        q: /(for|bucle|loop)/i,
        a: "Aquí tienes un ejemplo de bucle for en JavaScript:\n```js\nfor(let i=0; i<5; i++){ console.log(i); }\n```"
      },
      {
        q: /canvas/i,
        a: "Puedes usar el canvas para dibujar gráficos en la web. Prueba el botón 'Dibujar Rectángulo' abajo."
      },
      {
        q: /ocr|imagen|texto/i,
        a: "Puedes subir una imagen y pulsar 'Realizar OCR' para extraer texto."
      }
    ];
    function sendMsg() {
      const msg = userInput.value.trim();
      if (!msg) return;
      appendMsg('user', msg);
      setTimeout(()=>botReply(msg), 600);
      userInput.value = '';
    }
    function appendMsg(role, txt) {
      const msgBox = document.createElement('div');
      msgBox.className = 'chat-msg ' + role;
      msgBox.innerHTML = `<b>${role === 'user' ? 'Tú' : 'Claude'}:</b> ${txt.replace(/\n/g, '<br>')}`;
      chatbox.appendChild(msgBox);
      chatbox.scrollTop = chatbox.scrollHeight;
    }
    function botReply(msg) {
      for (let ex of predef) {
        if (ex.q.test(msg)) {
          appendMsg('bot', ex.a);
          return;
        }
      }
      appendMsg('bot', "Interesante pregunta. ¿Quieres ver un ejemplo de código o necesitas ayuda con alguna función?");
    }
    userInput.addEventListener("keydown", function(e) {
      if(e.key === "Enter") sendMsg();
    });

    // Canvas funciones
    const canvas = document.getElementById('mainCanvas');
    const ctx = canvas.getContext('2d');
    function drawRect() {
      ctx.fillStyle = "#8c55aa";
      ctx.fillRect(40, 40, 120, 60);
      ctx.font = "20px Segoe UI";
      ctx.fillStyle = "#fff";
      ctx.fillText("Claude", 70, 75);
    }
    function clearCanvas() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
    }
    function exportCanvas() {
      let link = document.createElement('a');
      link.download = 'canvas.png';
      link.href = canvas.toDataURL();
      link.click();
    }

    // OCR básico
    async function performOCR() {
      const file = document.getElementById('ocrInput').files[0];
      if (!file) { document.getElementById('ocrResult').textContent = "Selecciona una imagen primero."; return; }
      document.getElementById('ocrResult').textContent = "Procesando...";
      const img = new Image();
      img.onload = async () => {
        const result = await Tesseract.recognize(img, 'spa', { logger: m => {} });
        document.getElementById('ocrResult').textContent = result.data.text.trim() || "No se detectó texto.";
      };
      img.src = URL.createObjectURL(file);
    }
  </script>
</body>
</html>